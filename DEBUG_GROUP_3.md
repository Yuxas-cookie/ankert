# デバッググループ3: 分析・拡張機能

## 担当者向けガイド

### 担当範囲
1. **分析・レポート** - 回答集計、グラフ表示、エクスポート
2. **チーム・権限管理** - チーム機能、メンバー管理、権限設定
3. **UI/UX・テーマ** - 全体的なデザイン、レスポンシブ対応
4. **パフォーマンス・セキュリティ** - 最適化、セキュリティ確認
5. **その他の機能** - PWA、オフライン対応など

### 優先順位でのテスト順序

#### Phase 1: UI/UXとテーマ（最優先）
1. **Cosmicテーマの確認**
   - [ ] すべてのページでテーマが適用されている
   - [ ] ハードコードされた色がない
   - [ ] グラデーション効果の動作
   - [ ] アニメーションの滑らかさ

2. **テーマ切り替え**
   - [ ] ライトモード表示
   - [ ] ダークモード表示
   - [ ] 切り替えの即時反映
   - [ ] 設定の保存

3. **レスポンシブデザイン**
   - [ ] モバイル (375px)
   - [ ] タブレット (768px)
   - [ ] デスクトップ (1024px+)
   - [ ] 横向き対応

#### Phase 2: 分析・レポート機能（高優先）
1. **回答一覧** (`/surveys/[id]/responses`)
   - [ ] 回答データの表示
   - [ ] 回答者情報
   - [ ] タイムスタンプ
   - [ ] ページネーション

2. **基本統計**
   - [ ] 回答数
   - [ ] 完了率
   - [ ] 平均回答時間
   - [ ] 質問別の統計

3. **グラフ表示**
   - [ ] 円グラフ（単一選択）
   - [ ] 棒グラフ（複数選択）
   - [ ] 折れ線グラフ（時系列）
   - [ ] ヒートマップ（マトリックス）

4. **エクスポート機能**
   - [ ] CSV出力
   - [ ] Excel出力
   - [ ] PDF出力
   - [ ] フィルタリング後のエクスポート

#### Phase 3: チーム機能（中優先）
1. **チーム管理**
   - [ ] チーム作成
   - [ ] チーム情報編集
   - [ ] チーム削除

2. **メンバー管理**
   - [ ] メンバー招待
   - [ ] 役割設定
   - [ ] メンバー削除
   - [ ] 権限の確認

3. **アンケート共有**
   - [ ] チームメンバーとの共有
   - [ ] 権限レベルの設定
   - [ ] 共有解除

#### Phase 4: パフォーマンス最適化（中優先）
1. **読み込み速度**
   - [ ] 初回読み込み時間 < 3秒
   - [ ] ページ遷移 < 1秒
   - [ ] API応答時間 < 500ms

2. **画像最適化**
   - [ ] 適切なフォーマット
   - [ ] 遅延読み込み
   - [ ] サイズ最適化

3. **キャッシュ戦略**
   - [ ] 静的アセットのキャッシュ
   - [ ] APIレスポンスキャッシュ
   - [ ] Service Worker動作

#### Phase 5: セキュリティ確認（高優先）
1. **認証・認可**
   - [ ] 未認証アクセスの制御
   - [ ] 権限外データへのアクセス制御
   - [ ] セッションタイムアウト

2. **データ保護**
   - [ ] XSS対策の確認
   - [ ] SQLインジェクション対策
   - [ ] CSRF対策

3. **RLSポリシー**
   - [ ] surveys テーブル
   - [ ] questions テーブル
   - [ ] responses テーブル
   - [ ] teams テーブル

### デバッグ用コマンド

```bash
# パフォーマンス測定
npm run build
npm run analyze

# Lighthouse実行
npx lighthouse http://localhost:3000 --view

# セキュリティチェック
npm audit
```

### テストツール

#### レスポンシブテスト
- Chrome DevTools デバイスモード
- BrowserStack (オプション)
- 実機テスト推奨

#### パフォーマンステスト
```javascript
// ページ読み込み時間測定
console.time('PageLoad')
window.addEventListener('load', () => {
  console.timeEnd('PageLoad')
})

// API応答時間測定
console.time('APICall')
const { data } = await supabase.from('surveys').select('*')
console.timeEnd('APICall')
```

### グラフ表示のテストデータ

```javascript
// テスト用回答データ生成
const generateTestResponses = (surveyId, count = 50) => {
  const responses = []
  for (let i = 0; i < count; i++) {
    responses.push({
      survey_id: surveyId,
      user_id: null,
      is_test_response: true,
      started_at: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000),
      completed_at: new Date(),
      // ... その他のフィールド
    })
  }
  return responses
}
```

### UI/UXチェックリスト

#### 全体的な確認
- [ ] 一貫性のあるデザイン
- [ ] 適切なコントラスト比
- [ ] フォントサイズの可読性
- [ ] タッチターゲットのサイズ (最小44x44px)
- [ ] エラー状態の明確な表示
- [ ] ローディング状態の表示
- [ ] 空状態のデザイン

#### アクセシビリティ
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] ARIA属性の適切な使用
- [ ] フォーカス状態の表示

### よくある問題と対処法

#### 問題1: グラフが表示されない
- **確認事項**:
  - データの存在
  - Chart.jsの設定
  - コンソールエラー
- **デバッグ方法**:
  ```javascript
  console.log('Chart data:', chartData)
  console.log('Chart options:', chartOptions)
  ```

#### 問題2: エクスポートが失敗する
- **確認事項**:
  - ブラウザの互換性
  - データサイズ
  - メモリ使用量

#### 問題3: レスポンシブが崩れる
- **確認事項**:
  - CSSの優先順位
  - Tailwindのブレイクポイント
  - 固定幅の要素

### パフォーマンス最適化チェック

```javascript
// 画像の遅延読み込み確認
const images = document.querySelectorAll('img[loading="lazy"]')
console.log(`Lazy loading images: ${images.length}`)

// バンドルサイズ確認
// next.config.tsでbundle-analyzerを有効化
```

### 修正記録テンプレート

```markdown
### [日時] 分析/UI/パフォーマンス - [問題の概要]
- **テスト項目**: 
- **デバイス/環境**: 
- **問題内容**: 
- **影響範囲**: 
- **原因**: 
- **修正内容**: 
- **修正ファイル**: 
- **パフォーマンス改善**: 
- **確認結果**: 
```

### 完了基準
- [ ] 全ページでテーマが完璧に適用
- [ ] レスポンシブデザインが全デバイスで動作
- [ ] 分析機能が正確にデータを表示
- [ ] エクスポート機能が全形式で動作
- [ ] ページ読み込み時間が目標値以内
- [ ] セキュリティ脆弱性がない
- [ ] アクセシビリティ基準を満たす

---

*デバッグ結果は`DEVELOPMENT_LOG.md`に記録してください。*