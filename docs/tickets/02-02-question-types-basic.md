# チケット2-2: 質問タイプ実装（基本）

## 概要
基本的な質問タイプ（単一選択・複数選択・自由記述）の実装

## 目標
- 単一選択（ラジオボタン）質問の実装
- 複数選択（チェックボックス）質問の実装
- 自由記述（テキスト・テキストエリア）質問の実装
- 必須/任意設定の実装

## タスク詳細

### 1. 質問データ構造の実装
#### 1.1 質問CRUD操作
- [ ] `lib/supabase/questions.ts`
  - createQuestion（質問作成）
  - getQuestionsBySurveyId（質問一覧取得）
  - updateQuestion（質問更新）
  - deleteQuestion（質問削除）
  - reorderQuestions（質問順序変更）

#### 1.2 選択肢CRUD操作
- [ ] `lib/supabase/questionOptions.ts`
  - createOption（選択肢作成）
  - updateOption（選択肢更新）
  - deleteOption（選択肢削除）
  - reorderOptions（選択肢順序変更）

### 2. 質問タイプコンポーネント作成
#### 2.1 単一選択質問
- [ ] `components/survey/questions/SingleChoiceQuestion.tsx`
  - ラジオボタン表示
  - 選択肢動的表示
  - 必須バリデーション
  - カスタムスタイリング

#### 2.2 複数選択質問
- [ ] `components/survey/questions/MultipleChoiceQuestion.tsx`
  - チェックボックス表示
  - 複数選択処理
  - 選択数制限（オプション）
  - 必須バリデーション

#### 2.3 自由記述質問
- [ ] `components/survey/questions/TextQuestion.tsx`
  - 単行テキストフィールド
  - 複数行テキストエリア
  - 文字数制限
  - プレースホルダー設定

### 3. 質問編集コンポーネント
#### 3.1 質問エディタ
- [ ] `components/survey/editor/QuestionEditor.tsx`
  - 質問タイプ選択
  - 質問文入力
  - 必須/任意設定
  - 設定パネル

#### 3.2 選択肢エディタ
- [ ] `components/survey/editor/OptionsEditor.tsx`
  - 選択肢追加・削除
  - 選択肢テキスト編集
  - ドラッグ&ドロップ並び替え
  - その他オプション追加

### 4. 質問設定機能
#### 4.1 基本設定
- [ ] 質問タイプ変更
- [ ] 必須/任意切り替え
- [ ] 質問文の書式設定（太字・斜体など）
- [ ] ヘルプテキスト追加

#### 4.2 詳細設定
- [ ] 文字数制限設定
- [ ] 選択数制限設定
- [ ] プレースホルダー設定
- [ ] デフォルト値設定

### 5. バリデーション実装
#### 5.1 質問バリデーション
- [ ] `lib/validations/question.ts`
  - 質問文必須チェック
  - 質問タイプバリデーション
  - 選択肢最小数チェック
  - 設定値バリデーション

#### 5.2 回答バリデーション
- [ ] 必須質問のチェック
- [ ] 文字数制限チェック
- [ ] 選択数制限チェック
- [ ] フォーマットチェック

### 6. 質問プレビュー機能
#### 6.1 リアルタイムプレビュー
- [ ] 編集内容の即座反映
- [ ] 実際の回答画面と同じ表示
- [ ] レスポンシブプレビュー
- [ ] テスト回答機能

#### 6.2 プレビューコンポーネント
- [ ] `components/survey/preview/QuestionPreview.tsx`
  - 質問タイプ別表示
  - インタラクティブな操作
  - 必須マーク表示

### 7. 質問一覧・管理機能
#### 7.1 質問リスト
- [ ] `components/survey/editor/QuestionList.tsx`
  - 質問一覧表示
  - 質問タイプアイコン
  - 編集・削除アクション
  - 複製機能

#### 7.2 質問順序変更
- [ ] ドラッグ&ドロップ機能
- [ ] 順序番号表示
- [ ] 自動保存

### 8. 回答収集機能
#### 8.1 回答フォーム生成
- [ ] 質問タイプ別フォーム生成
- [ ] 動的フォームレンダリング
- [ ] 回答データ構造化
- [ ] 進捗表示

#### 8.2 回答保存
- [ ] 質問別回答保存
- [ ] JSON形式での値保存
- [ ] 一時保存機能
- [ ] バリデーション統合

### 9. パフォーマンス最適化
#### 9.1 レンダリング最適化
- [ ] React.memo使用
- [ ] useCallback最適化
- [ ] 仮想化（大量質問対応）
- [ ] 遅延読み込み

#### 9.2 データ最適化
- [ ] 必要なデータのみ取得
- [ ] キャッシュ機能
- [ ] 楽観的更新

## 完了条件
- [ ] 単一選択質問が作成・編集・回答できる
- [ ] 複数選択質問が作成・編集・回答できる
- [ ] 自由記述質問が作成・編集・回答できる
- [ ] 必須/任意設定が動作する
- [ ] 質問の順序変更ができる
- [ ] バリデーションが適切に機能する

## テストケース
1. 各質問タイプを作成できる
2. 選択肢の追加・削除・並び替えができる
3. 質問の必須/任意設定が動作する
4. 回答時にバリデーションが機能する
5. 質問の順序変更ができる
6. プレビュー機能が正常に動作する
7. 文字数制限などの設定が適用される
8. 回答データが正しい形式で保存される

## 依存関係
- チケット2-1: アンケート作成基盤（必須）
- チケット1-2: 基本UIコンポーネント作成（推奨）

## 並行開発可能チケット
- チケット2-3: 質問タイプ実装（高度）
- チケット3-1: プレビュー機能

## 次のチケット
- チケット2-4: アンケート編集UI
- チケット3-3: 回答機能

## 参考資料
- docs/REQUIREMENTS.md（質問タイプ要件）
- types/survey.ts（質問型定義）
- @dnd-kit公式ドキュメント
- React Hook Form公式ドキュメント