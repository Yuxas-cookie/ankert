# チケット1-3: 認証システム実装

## 概要
Supabase Authを使用した認証システムの実装

## 目標
- メール/パスワード認証の実装
- Google OAuth認証の実装
- セッション管理の実装
- 認証状態に基づくページ保護

## タスク詳細

### 1. 認証フック・コンテキスト作成
#### 1.1 認証コンテキスト
- [ ] `lib/contexts/AuthContext.tsx`
  - ユーザー状態管理
  - 認証状態の監視
  - ログイン・ログアウト機能

#### 1.2 認証フック
- [ ] `lib/hooks/useAuth.ts`
  - 認証状態の取得
  - ユーザー情報の取得
  - 認証アクション

### 2. 認証ページの作成
#### 2.1 ログインページ
- [ ] `app/(auth)/login/page.tsx`
  - メール/パスワードフォーム
  - Google OAuth ボタン
  - パスワードリセットリンク
  - サインアップページへのリンク

#### 2.2 サインアップページ
- [ ] `app/(auth)/register/page.tsx`
  - メール/パスワード登録フォーム
  - Google OAuth ボタン
  - 利用規約チェックボックス
  - ログインページへのリンク

#### 2.3 パスワードリセットページ
- [ ] `app/(auth)/reset-password/page.tsx`
  - メールアドレス入力フォーム
  - リセットメール送信
  - 確認メッセージ表示

#### 2.4 パスワード更新ページ
- [ ] `app/(auth)/update-password/page.tsx`
  - 新しいパスワード入力
  - パスワード確認
  - 更新処理

### 3. 認証レイアウト
- [ ] `app/(auth)/layout.tsx`
  - 認証ページ共通レイアウト
  - 中央配置デザイン
  - ロゴ・ブランディング

### 4. フォームバリデーション
#### 4.1 バリデーションスキーマ
- [ ] `lib/validations/auth.ts`
  - メールアドレス形式チェック
  - パスワード強度チェック
  - 必須項目チェック

#### 4.2 フォームコンポーネント
- [ ] `components/auth/LoginForm.tsx`
- [ ] `components/auth/RegisterForm.tsx`
- [ ] `components/auth/ResetPasswordForm.tsx`

### 5. 認証ガード実装
#### 5.1 ミドルウェア
- [ ] `middleware.ts`
  - 認証が必要なページの保護
  - 未認証時のリダイレクト
  - 認証済み時のリダイレクト

#### 5.2 ページ保護コンポーネント
- [ ] `components/auth/ProtectedRoute.tsx`
  - 認証状態チェック
  - ローディング表示
  - 未認証時のリダイレクト

### 6. セッション管理
#### 6.1 サーバーサイド認証
- [ ] `lib/supabase/server.ts`の認証対応
- [ ] サーバーコンポーネントでの認証状態取得

#### 6.2 クライアントサイド認証
- [ ] `lib/supabase/client.ts`の認証対応
- [ ] クライアントコンポーネントでの認証状態取得

### 7. Google OAuth設定
#### 7.1 Supabase設定
- [ ] Google OAuth プロバイダー有効化
- [ ] クライアントID・シークレット設定
- [ ] リダイレクトURL設定

#### 7.2 実装
- [ ] Google OAuth ボタンコンポーネント
- [ ] OAuth コールバック処理
- [ ] エラーハンドリング

### 8. エラーハンドリング
- [ ] 認証エラーメッセージ表示
- [ ] ネットワークエラー対応
- [ ] バリデーションエラー表示
- [ ] トースト通知

### 9. ユーザープロファイル
#### 9.1 プロファイル表示
- [ ] `app/(dashboard)/profile/page.tsx`
  - ユーザー情報表示
  - アバター画像
  - アカウント情報

#### 9.2 プロファイル編集
- [ ] プロファイル編集フォーム
- [ ] パスワード変更
- [ ] アカウント削除

## 完了条件
- [ ] メール/パスワード認証が動作する
- [ ] Google OAuth認証が動作する
- [ ] 認証状態に基づくページ保護ができている
- [ ] セッション管理が正常に動作する
- [ ] エラーハンドリングが適切に行われている

## テストケース
1. メール/パスワードでログインできる
2. メール/パスワードでサインアップできる
3. Google OAuthでログインできる
4. パスワードリセットができる
5. 未認証時にダッシュボードにアクセスできない
6. ログイン後に適切にリダイレクトされる
7. ログアウトが正常に動作する
8. セッション期限切れが適切に処理される

## 依存関係
- チケット1-1: Supabase環境構築（必須）
- チケット1-2: 基本UIコンポーネント作成（推奨）

## 次のチケット
- チケット2-1: アンケート作成基盤
- 全ての認証が必要な機能

## 参考資料
- Supabase Auth公式ドキュメント
- Next.js認証ガイド
- docs/SETUP.md（認証設定）
- docs/REQUIREMENTS.md（認証要件）