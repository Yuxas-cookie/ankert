# チケット2-1: アンケート作成基盤

## 概要
アンケートの基本CRUD操作と下書き機能の実装

## 目標
- アンケートの作成・読み取り・更新・削除機能
- 下書き保存・自動保存機能
- バリデーション機能
- 基本的なアンケート管理機能

## タスク詳細

### 1. データアクセス層の実装
#### 1.1 Supabaseクエリ関数
- [ ] `lib/supabase/surveys.ts`
  - createSurvey（アンケート作成）
  - getSurveys（アンケート一覧取得）
  - getSurveyById（アンケート詳細取得）
  - updateSurvey（アンケート更新）
  - deleteSurvey（アンケート削除）
  - saveDraft（下書き保存）

#### 1.2 型安全なクエリ
- [ ] TypeScriptでの型安全性確保
- [ ] エラーハンドリング
- [ ] レスポンスの正規化

### 2. バリデーションスキーマ
#### 2.1 Zodスキーマ定義
- [ ] `lib/validations/survey.ts`
  - アンケートタイトル（必須、最大255文字）
  - アンケート説明（任意、最大1000文字）
  - 公開設定バリデーション
  - 質問配列のバリデーション

#### 2.2 フロントエンド・バックエンド共通バリデーション
- [ ] クライアントサイドバリデーション
- [ ] サーバーサイドバリデーション
- [ ] リアルタイムバリデーション

### 3. アンケート作成フォーム
#### 3.1 基本情報フォーム
- [ ] `components/survey/SurveyBasicForm.tsx`
  - タイトル入力
  - 説明文入力
  - 公開設定選択
  - 保存・公開ボタン

#### 3.2 React Hook Form統合
- [ ] フォーム状態管理
- [ ] バリデーション統合
- [ ] エラーメッセージ表示
- [ ] 送信処理

### 4. 下書き機能
#### 4.1 自動保存システム
- [ ] `lib/hooks/useAutoSave.ts`
  - 2-3秒間のデバウンス処理
  - 変更検知機能
  - 保存状態表示
  - エラー時の再試行

#### 4.2 下書き状態管理
- [ ] 下書きフラグ管理
- [ ] 最終更新日時記録
- [ ] 保存状態インジケーター

### 5. アンケート一覧機能
#### 5.1 ダッシュボード
- [ ] `app/(dashboard)/surveys/page.tsx`
  - アンケート一覧表示
  - ステータス別フィルタ
  - 検索機能
  - ページネーション

#### 5.2 アンケートカード
- [ ] `components/survey/SurveyCard.tsx`
  - タイトル・説明表示
  - ステータス表示
  - 回答数表示
  - アクション（編集・削除・複製）

### 6. アンケート詳細ページ
#### 6.1 詳細表示
- [ ] `app/(dashboard)/surveys/[id]/page.tsx`
  - アンケート基本情報
  - 質問一覧
  - 統計情報
  - アクションボタン

#### 6.2 編集ページ
- [ ] `app/(dashboard)/surveys/[id]/edit/page.tsx`
  - フォーム再利用
  - 既存データの読み込み
  - 更新処理

### 7. 状態管理
#### 7.1 アンケート状態管理
- [ ] `lib/stores/surveyStore.ts`（Zustand使用）
  - 現在編集中のアンケート
  - 保存状態
  - エラー状態

#### 7.2 キャッシュ戦略
- [ ] React QueryまたはSWR統合（オプション）
- [ ] 楽観的更新
- [ ] バックグラウンド同期

### 8. エラーハンドリング
#### 8.1 エラー表示
- [ ] フォームエラー表示
- [ ] ネットワークエラー対応
- [ ] 権限エラー対応
- [ ] トースト通知

#### 8.2 エラー境界
- [ ] Error Boundary実装
- [ ] フォールバックUI
- [ ] エラーレポート

### 9. ユーティリティ機能
#### 9.1 アンケート複製
- [ ] 既存アンケートの複製機能
- [ ] タイトル自動生成
- [ ] 下書き状態でコピー

#### 9.2 一括操作
- [ ] 複数選択機能
- [ ] 一括削除
- [ ] 一括ステータス変更

## 完了条件
- [ ] アンケートの基本CRUD操作が動作する
- [ ] 下書き保存・自動保存が動作する
- [ ] バリデーションが適切に機能する
- [ ] アンケート一覧・詳細表示が動作する
- [ ] エラーハンドリングが適切に行われている

## テストケース
1. 新規アンケートを作成できる
2. アンケート一覧が表示される
3. アンケートを編集・更新できる
4. アンケートを削除できる
5. 下書き保存が自動で動作する
6. バリデーションエラーが適切に表示される
7. 権限のないアンケートにアクセスできない
8. 複製機能が正常に動作する

## 依存関係
- チケット1-1: Supabase環境構築（必須）
- チケット1-3: 認証システム実装（必須）
- チケット1-2: 基本UIコンポーネント作成（推奨）

## 次のチケット
- チケット2-2: 質問タイプ実装（基本）
- チケット2-4: アンケート編集UI
- チケット3-1: プレビュー機能

## 参考資料
- docs/REQUIREMENTS.md（アンケート機能要件）
- types/survey.ts（型定義）
- Supabase公式ドキュメント
- React Hook Form公式ドキュメント